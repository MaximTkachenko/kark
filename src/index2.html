<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <script src="dist/main.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" />
    <link rel="stylesheet" href="Content/style.css" />
    <title>kark</title>
</head>
<body>
<div id="root">
</div>
<script>
    var players = new playerService();
    var objectsStore = tileObjectsService();
</script>
<script type="text/babel">
    var Player = React.createClass({
        render: function() {
            var playerClasses = ["player-details"];
            if(this.props.current){
                playerClasses.push("player-details__current");
            }            
            var playerClassFinal = playerClasses.join(" ");
    
            var nameStyle = { color: this.props.color };

            return (
                <div className={playerClassFinal} id={this.props.name}>
                    <div><label style={nameStyle}>{this.props.name}</label></div>
                    <div>score:  {this.props.score}</div>
                    <div>flags: {this.props.availableFlags}</div>
                </div>);
        }
    });

    var PlayersList = React.createClass({
        getInitialState: function(){
            players.registerChangeListener(this.updateState);
            return { players: players.getPlayers() }; 
        },
        updateState: function(){
            this.setState({ players: players.getPlayers() });
        },
        render: function(){
            return (<div>
                {this.state.players.map(function(player){
                    return <Player key={player.name} {...player}/>
                })}
            </div>);
        }
    });
    
    $(document).ready(function(){
        $('#local-game-start-btn').click(function(){
            var usersNumber = parseInt($('#local-game-users-number').val());
            var tilesSetNumber = parseInt($('#local-game-tiles-set').val());
    
            var flagsStartNumber = 8;
            var defaultUsers = [{name: "Frodo Baggins", color: "#FF333C", hexColor: 0xFF333C, availableFlags: flagsStartNumber, score: 0},
                {name: "Gandalf the Grey", color: "#3933FF", hexColor: 0x3933FF, availableFlags: flagsStartNumber, score: 0},
                {name: "Aragorn", color: "#010106", hexColor: 0x010106, availableFlags: flagsStartNumber, score: 0},
                {name: "Sauron", color: "#F47C41", hexColor: 0xF47C41, availableFlags: flagsStartNumber, score: 0}
            ];

            for (var i = 0, imax = usersNumber; i < imax; i++){
                players.add(defaultUsers[i]);
            }
            
            var game = new KarkGame(players, objectsStore, new GameDragger(), tilesMetadata, tileQueueService(tilesMetadata, tilesSetNumber), Phaser, "tiles");
            ReactDOM.render(<PlayersList />, document.getElementById("players") );
            
            $('#mode-selector').remove();
            $("#game-info").removeClass("hidden");
        });
    
        $(document).on("game.over", function(e, data) {
            $("#game-over-dialog").modal().find(".modal-body").text("WINNERS: " + data.winners.map(function(w){return w.name;}).join(", ") + "!");
        });
    });

</script>
</body>
</html>
